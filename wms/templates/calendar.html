{% extends 'layout3.html' %}
{% block body %}

<!-- Month Tabs and Day Buttons Styles -->
<style>
    /* Make all tab texts black */
    #monthTabs .nav-link {
        color: black !important;
        font-size: 1rem;
        white-space: nowrap;
    }
    /* Make the active tab bold */
    #monthTabs .nav-link.active {
        font-weight: bold;
    }
    /* Tabs container - scrollable with no scrollbar */
    #monthTabs {
        display: flex;
        flex-wrap: nowrap !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch; /* smooth scrolling on iOS */
        scrollbar-width: none; /* Firefox */
    }
    #monthTabs::-webkit-scrollbar {
        display: none; /* Chrome, Safari */
    }
    #monthTabs .nav-item {
        flex: 0 0 auto; /* fix tab width */
    }

    /* GRID for days: 7 equal columns */
    .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }

    /* Day button styles */
    .day-btn {
        width: 100% !important;
        min-height: 90px;
        padding: 8px 5px;
        white-space: normal;
        overflow-wrap: break-word;
        font-size: 1.1rem;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
        border-radius: 5px;
        position: relative;
        border-width: 2px !important;
    }

    /* Highlight buttons with tasks with a badge */
    .badge-task-count {
        position: absolute;
        bottom: 5px;
        right: 5px;
        font-size: 0.8rem;
        background-color: #dc3545;
        color: white;
        border-radius: 50%;
        padding: 0.25em 0.5em;
    }

    /* Responsive tweaks for small screens */
    @media (max-width: 575px) {
        .day-btn {
            min-height: 75px;
            font-size: 0.9rem;
            padding: 6px 4px;
        }
    }
</style>

<div class="container mt-5 pt-5">

    <ul class="nav nav-tabs mt-3" id="monthTabs" role="tablist">
        {% for month in months %}
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if month.number == current_month %}active{% endif %}" 
                    id="tab-{{ month.number }}" data-bs-toggle="tab" 
                    data-bs-target="#month-{{ month.number }}" type="button" role="tab">
                {{ month.name }}
            </button>
        </li>
        {% endfor %}
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-3">
        {% for month in months %}
        <div class="tab-pane fade {% if month.number == current_month %}show active{% endif %}" 
             id="month-{{ month.number }}" role="tabpanel">
            <div class="days-grid">
                {% for day in month.days %}
                <button type="button" class="btn btn-light day-btn"
                        data-bs-toggle="modal" 
                        data-bs-target="#taskModal-{{ day.date|date:'Y_m_d' }}">
                    <div style="font-size: 1.5rem; font-weight: bold;">{{ day.day }}</div>
                    <div style="font-size: 1rem; color: gray;">{{ day.date|date:'D' }}</div>
                    {% if day.tasks %}
                    <span class="badge-task-count">{{ day.tasks|length }}</span>
                    {% endif %}
                </button>

                <!-- Task Modal -->
                <div class="modal fade" id="taskModal-{{ day.date|date:'Y_m_d' }}" tabindex="-1" aria-labelledby="taskModalLabel-{{ day.date|date:'Y_m_d' }}" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="taskModalLabel-{{ day.date|date:'Y_m_d' }}">
                                    Tasks for {{ day.date|date:'M d, Y' }}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {% if day.tasks %}
                                <ul class="list-group">
                                    {% for task in day.tasks %}
                                    <li class="list-group-item">
                                        <strong>{{ task.name }}</strong> - <em>{{ task.project }}</em> - Assigned to: <strong>{{ task.assignedTo }}</strong>
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted">No tasks for this day.</p>
                                {% endif %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
