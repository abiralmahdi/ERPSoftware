{% extends "layout3.html" %}
{% block body %}

<style>
    #gantt {
        min-height: 1200px !important;
        height: 1200px !important;
    }

    /* Task colors based on class */
    .bar.overdue { fill: rgb(220, 53, 69) !important; }       /* red */
    .bar.ongoing { fill: rgb(255, 193, 7) !important; }       /* yellow */
    .bar.future  { fill: rgb(54, 162, 235) !important; }      /* blue */

    /* Progress colors */
    .bar.overdue .bar-progress { fill: rgb(200, 30, 50) !important; }
    .bar.ongoing .bar-progress { fill: rgb(255, 160, 0) !important; }
    .bar.future  .bar-progress { fill: rgb(30, 100, 200) !important; }
</style>

<div class="container">
    <h5 class="mb-4 mt-3">{{ indivProject.title }} - Timeline </h5>
    <div id="gantt"></div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt/dist/frappe-gantt.css">
<script src="https://cdn.jsdelivr.net/npm/frappe-gantt/dist/frappe-gantt.umd.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tasks = {{ tasks|safe }};
    const today = new Date();

    const ganttTasks = tasks.map(task => {
        const start = new Date(task.start);
        const end = new Date(task.end);
        let custom_class = "";

        if (end < today) custom_class = "overdue";
        else if (start <= today && end >= today) custom_class = "ongoing";
        else custom_class = "future";

        return {
            ...task,
            custom_class: custom_class,
            progress: task.progress || 0
        };
    });

    const gantt = new Gantt("#gantt", ganttTasks, {
        view_mode: 'Day',
        date_format: 'YYYY-MM-DD',
        popup_trigger: 'click',
        custom_popup_html: function(task) {
            return `
                <div class="details-container">
                    <h5>${task.name}</h5>
                    <p>Start: ${task.start}</p>
                    <p>End: ${task.end}</p>
                    <p>Progress: ${task.progress}%</p>
                </div>
            `;
        }
    });
});
</script>

{% endblock %}
