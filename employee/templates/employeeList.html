{% extends 'layout.html' %}
{% block body %}
<style>
    /* Ensure thead stays visible when scrolling */
    .sticky-header th {
        position: sticky;
        top: 0;
        z-index: 2;
        background-color: #f8f9fa; /* matches Bootstrap table header color */
    }

    /* Reduce table row height by lowering padding */
    .table th, 
    .table td {
        padding-top: 0.2rem;
        padding-bottom: 0.1rem;
    }

    /* Container becomes fluid on smaller screens */
@media (max-width: 1199px) {
  .container[style*="min-width: 1600px"] {
    min-width: unset !important;
    padding-left: 1rem !important;
    padding-right: 1rem !important;
    box-sizing: border-box;
  }
}

/* Stack search form controls vertically on small screens */
@media (max-width: 991px) {
  .d-flex.mb-3 {
    flex-wrap: wrap !important;
    gap: 10px;
  }
  .d-flex.mb-3 form.d-flex {
    flex: 1 1 100% !important;
    justify-content: flex-start !important;
    gap: 10px !important;
  }
  .d-flex.mb-3 form.d-flex input.form-control,
  .d-flex.mb-3 form.d-flex select.btn,
  .d-flex.mb-3 form.d-flex button.btn {
    width: 100% !important;
    min-width: 120px;
  }
  .d-flex.mb-3 > button.btn-dark {
    flex: 1 1 100% !important;
    max-width: 350px;
    margin-left: 0 !important;
  }
}

/* Table is horizontally scrollable with minimum width */
@media (max-width: 991px) {
  .table-container {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    max-height: 500px;
    border: 1px solid #ddd;
  }
  table.table {
    min-width: 1100px; /* approx total width of columns */
    font-size: 0.9rem;
    table-layout: auto;
  }
  table.table th, table.table td {
    padding: 0.3rem 0.6rem;
    white-space: nowrap;
    vertical-align: middle;
  }
  thead.sticky-header th {
    position: sticky;
    top: 0;
    background: #f8f9fa;
    z-index: 10;
  }
}

/* Further compaction on small phones */
@media (max-width: 575px) {
  .table-container {
    max-height: 750px !important;
  }
  table.table {
    min-width: 900px;
    font-size: 0.85rem !important;
  }
  table.table th, table.table td {
    padding: 0.2rem 0.4rem !important;
  }
  .btn,
  .btn-dark {
    font-size: 0.8rem !important;
    padding: 0.3rem 0.5rem !important;
  }
}

/* Sidebar links wrap nicely */
.bg-light .nav-link {
  word-break: break-word;
}
.bg-light .nav-link.fw-bold.shadow {
  box-shadow: 0 1px 3px rgba(0,0,0,0.12);
  border-radius: 0.2em;
}

</style>
<!-- Modal -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form method="POST" enctype="multipart/form-data" action="/employees/addEmployee">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="addEmployeeModalLabel">Add Employee</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <!-- User Fields -->
              <div class="row">
                <div class="col-md-6">
                  <label>First Name</label>
                  <input type="text" name="first_name" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label>Last Name</label>
                  <input type="text" name="last_name" class="form-control" required>
                </div>
                <div class="col-md-6 mt-2">
                  <label>Email</label>
                  <input type="text" name="username" class="form-control" required>
                </div>
                <!-- Phone -->
                <div class="col-md-6 mt-2">
                    <label>Phone</label>
                    <input type="text" name="phone" class="form-control" required>
                </div>

              </div>
  
              <!-- Employee Fields -->
              <div class="row mt-3">
                
                <!-- Date of Birth -->
                <div class="col-md-6 mb-3">
                    <label>Date of Birth</label>
                    <input type="date" name="date_of_birth" class="form-control" required>
                </div>
            
                <!-- Department -->
                <div class="col-md-6 mb-3">
                    <label>Department</label>
                    <select name="department" class="form-control" required>
                        <option value="">Select Department</option>
                        {% for dept in departments %}
                            <option value="{{ dept.id }}">{{ dept.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            
                <!-- Designation -->
                <div class="col-md-6 mb-3">
                    <label>Designation</label>
                    <select name="designation" class="form-control" required>
                        <option value="">Select Designation</option>
                        {% for desig in designations %}
                            <option value="{{ desig.id }}">{{ desig.title }}</option>
                        {% endfor %}
                    </select>
                </div>
            
                <!-- Salary -->
                <div class="col-md-6 mb-3">
                    <label>Salary</label>
                    <input type="number" name="salary" class="form-control" step="0.01" required>
                </div>
            
                <!-- Status -->
                <div class="col-md-6 mb-3">
                    <label>Status</label>
                    <select name="status" class="form-control" required>
                        <option value="Active">Active</option>
                        <option value="Leave">Leave</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
            
                <!-- Password -->
                <div class="col-md-6 mb-3">
                    <label>Password</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
            
                <!-- Profile Picture -->
                <div class="col-md-6 mb-3">
                    <label>Profile Picture</label>
                    <input type="file" name="profile_picture" class="form-control">
                </div>
            </div>
            
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-dark">Save Employee</button>
          </div>
        </form>
      </div>
    </div>
  </div>


<div class="container" style="margin-top: 80px; min-width: 1600px">
    <div class="d-flex mb-3">
        <form class="form d-flex me-auto" action="/employees/searchEmployee" method="POST">
            {% csrf_token %}
            <!-- Search Input -->
            <input type="text" class="form-control" style="height: 40px; width: 500px;" name="employeeSearch" placeholder="Search employees...">
    
            <!-- Search Button -->
            <button type="submit" class="btn btn-dark ms-2">Search</button>
    
            <!-- Department Dropdown -->
            <select name="department" class="btn btn-outline-dark ms-2" style="height: 40px;">
                <option class="bg-light text-dark" value="">All Departments</option>
                {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if request.GET.department == dept.id|stringformat:"s" %}selected{% endif %} class="bg-light text-dark">
                        {{ dept.name }}
                    </option>
                {% endfor %}
            </select>
    
            <!-- Designation Dropdown -->
            <select name="designation" class="btn btn-outline-dark ms-2" style="height: 40px;">
                <option class="bg-light text-dark" value="">All Designations</option>
                {% for desig in designations %}
                    <option value="{{ desig.id }}" {% if request.GET.designation == desig.id|stringformat:"s" %}selected{% endif %} class="bg-light text-dark">
                        {{ desig.title }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <button class="btn btn-dark ms-auto" data-bs-toggle="modal" data-bs-target="#addEmployeeModal"><i class="fa-solid fa-plus me-3"></i>Add Employee</button>
        <a href="/employees/scanNewEmployee" class="btn btn-dark ms-2" ><i class="fa-solid fa-magnifying-glass me-3"></i>Scan New Employees</a>
    </div>
    

    <div class="table-container" style="max-height: 650px; overflow-y: auto; position: relative;">
        <table class="table table-striped">
            <thead class="sticky-header">
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Department</th>
                    <th>Date of Birth</th>
                    <th>Joining Date</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                <tr>
                    <td>{{ employee.id }}</td>
                    <td>{{ employee.user.first_name }} {{ employee.user.last_name }}</td>
                    <td>{{ employee.designation.title }}</td>
                    <td>{{ employee.department.name }}</td>
                    <td>{{ employee.date_of_birth }}</td>
                    <td>{{ employee.join_date }}</td>
                    <td>{{ employee.user.email }}</td>
                    <td>{{ employee.phone }}</td>
                    <td>
                        <span class="badge bg-{% if employee.status == 'Active' %}success{% elif employee.status == 'Leave' %}warning{% else %}danger{% endif %}">
                            {{ employee.status }}
                        </span>
                    </td>
                    <td><a href="/employees/indivEmployee/{{employee.id}}" class="btn btn-dark btn-sm"><i class="fa-solid fa-gear"></i></a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        const departmentSelect = document.querySelector('select[name="department"]');
        const designationSelect = document.querySelector('select[name="designation"]');

        departmentSelect.addEventListener('change', () => {
            departmentSelect.form.submit();
        });

        designationSelect.addEventListener('change', () => {
            designationSelect.form.submit();
        });
    });
</script>

{% endblock %}